<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Foydalanuvchilar Boshqaruv Tizimi</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="./css/style.css">
</head>

<body>
    <div class="container">
        <header>
            <h1>Foydalanuvchilar Boshqaruv Tizimi</h1>
            <p class="app-description">Foydalanuvchilarni qo'shing, tahrirlang va boshqaring</p>
        </header>

        <div class="app-content">
            <section class="form-section">
                <h2 class="section-title"><i class="fas fa-user-plus"></i> Yangi Foydalanuvchi</h2>
                <form id="userForm">
                    <div class="form-group">
                        <label for="name">Ism</label>
                        <input type="text" name="name" placeholder="Foydalanuvchi ismini kiriting">
                    </div>
                    <div class="form-group">
                        <label for="age">Yosh</label>
                        <input type="number" name="age" placeholder="Foydalanuvchi yoshini kiriting">
                    </div>
                    <button type="submit" class="btn btn-block">Qo'shish</button>
                </form>
            </section>

            <section class="users-section">
                <h2 class="section-title"><i class="fas fa-users"></i> Foydalanuvchilar Ro'yxati</h2>
                <ul class="user-list" id="userList">
                    <li class="empty-state">
                        <i class="fas fa-user-slash"></i>
                        <p>Hozircha foydalanuvchilar mavjud emas</p>
                    </li>
                </ul>
            </section>
        </div>
    </div>

    <!-- Edit User Modal -->
    <div class="modal" id="editModal">
        <div class="modal-content">
            <button class="close-modal" id="closeModal">&times;</button>
            <h2 class="modal-title">Foydalanuvchini Tahrirlash</h2>
            <form id="editForm">
                <input type="hidden" id="editId">
                <div class="form-group">
                    <label for="editName">Ism</label>
                    <input type="text" name="name" placeholder="Yangi ism kiriting" required>
                </div>
                <div class="form-group">
                    <label for="editAge">Yosh</label>
                    <input type="number" name="age" placeholder="Yangi yosh kiriting" min="1" max="120" required>
                </div>
                <button type="submit" class="btn btn-block btn-edit">Saqlash</button>
            </form>
        </div>
    </div>

    <script>
        const userForm = document.querySelector('#userForm');
        const userList = document.querySelector('#userList');
        const editModal = document.querySelector('#editModal');
        const closeModal = document.querySelector('#closeModal');
        const editForm = document.querySelector('#editForm');
        let currentEditId = null;

        // Close modal function
        function closeEditModal() {
            editModal.style.display = 'none';
            currentEditId = null;
            editForm.reset();
        }

        // Close modal when clicking X
        closeModal.addEventListener('click', closeEditModal);

        // Close modal when clicking outside the modal
        editModal.addEventListener('click', function (e) {
            if (e.target === editModal) {
                closeEditModal();
            }
        });

        // Load users from backend
        function loadUsers() {
            fetch('backend/user/get.php')
                .then(res => res.json())
                .then(response => {
                    console.log(response)

                    response.forEach(user => {
                        const li = document.createElement('li');
                        li.className = 'user-item';
                        li.innerHTML = `
                        <div class="user-info">
                            <div class="user-name">${user.name}</div>
                            <div class="user-age">${user.age} yosh</div>
                        </div>
                        <div class="user-actions">
                            <button class="btn btn-edit edit-btn" data-id="${user.id}">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-danger delete-btn" data-id="${user.id}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    `;
                        userList.appendChild(li);
                    });
                })
        }

        loadUsers()

        userForm.addEventListener('submit', function (e) {
            e.preventDefault();

            let formData = new FormData(userForm);

            let data = {
                id: Date.now(),
                name: formData.get('name'),
                age: parseInt(formData.get('age'))
            };

            fetch('backend/user/add.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
                .then(res => res.json())
                .then(response => {
                    if (response.success === true) {

                        userForm.reset();
                    } else {
                        alert('Foydalanuvchi qo\'shishda xatolik yuz berdi: ' + response.message);
                    }
                })
                .catch(error => console.error('Error:', error));
        });

    </script>
</body>

</html>